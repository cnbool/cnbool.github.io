
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Hexo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="John Doe">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description">

    
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Hexo" title="Hexo"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Hexo">Hexo</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/categories">目录</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
						<form class="search">
							<label>Search</label>
						<input type="text" id="ts-search-input" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/08/17/linux/linux常用命令/" title="linux常用命令" itemprop="url">linux常用命令</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2014-08-16T21:18:40.000Z" itemprop="datePublished"> 发表于 2014-08-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">开放端口11211</span><br><span class="line"># /sbin/iptables -I INPUT -p tcp --dport 11211 -j ACCEPT</span><br><span class="line">保存</span><br><span class="line"># /etc/rc.d/init.d/iptables save</span><br><span class="line">查看打开的端口：</span><br><span class="line"># /etc/init.d/iptables status</span><br><span class="line"></span><br><span class="line">关闭防火墙</span><br><span class="line"># /etc/init.d/iptables stop</span><br><span class="line">重启防火墙</span><br><span class="line"># /etc/init.d/iptables restart</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">查看IP</span><br><span class="line"># ifconfig eth0</span><br><span class="line">修改IP</span><br><span class="line"># /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">HWADDR=</span><br><span class="line">ONBOOT=yes</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">IPADDR=&lt;你的IP&gt;</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.0.1</span><br></pre></td></tr></table></figure>
<p>重启network服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure></p>
<p>配置DNS<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/resolv.conf</span><br><span class="line">nameserver 223.5.5.5</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="远程连接配置"><a href="#远程连接配置" class="headerlink" title="远程连接配置"></a>远程连接配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">使用SSH</span><br><span class="line"># vi /etc/ssh/sshd_config</span><br><span class="line">将Port,Protocol等注释去掉</span><br><span class="line">修改/etc/hosts.deny 在最后面添加一行：</span><br><span class="line">sshd:All</span><br><span class="line">修改/etc/hosts.allow 在最后面添加一行：</span><br><span class="line">sshd:All</span><br><span class="line">启动SSH</span><br><span class="line"># /etc/init.d/sshd start</span><br><span class="line">在防火墙中开放SSH使用的端口</span><br><span class="line">在Windows上使用PuTTY连接CentOS</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><p>删除文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf 文件名</span><br></pre></td></tr></table></figure></p>
<p>参数说明:<br>-rf r:recursion(递归),f:force(强制)</p>
<p>修改文件权限chmod<br>三种权限:<br>Read Write Execute<br>  1    1     1<br>r=4<br>w=2<br>x=1<br>rwx=7<br>rw=6</p>
<p>改变文件权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 761 temp.zip</span><br></pre></td></tr></table></figure></p>
<p>root的权限是 rwx（读写和执行权限），<br>所属用户组权限是 rw (只有读写权限)，<br>对于其它用户权限是 x(只有只执行权限)</p>
<p>递归改变目录权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 -R /usr/local/mydir</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="tar-命令-磁带归档-Tape-Archive"><a href="#tar-命令-磁带归档-Tape-Archive" class="headerlink" title="tar 命令,磁带归档(Tape Archive)"></a>tar 命令,磁带归档(Tape Archive)</h3><p>tar [-cxtzjvfpPN] 文件/目录</p>
<p>参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-c ：建立</span><br><span class="line">-x ：解压</span><br><span class="line">-t ：查看</span><br><span class="line"></span><br><span class="line">-z:	gzip</span><br><span class="line">-j: bzip2</span><br><span class="line">-v: 进度</span><br><span class="line">-f: 文档名</span><br><span class="line">-p: 属性不变</span><br><span class="line">-P: 使用绝对路径来压缩</span><br><span class="line">-N：比后面接的日期(yyyy/mm/dd)还要新的才会被打包进新建的文件中</span><br><span class="line">--exclude FILE：在压缩的过程中,排除FILE</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar -cvf /tmp/etc.tar /etc // 打包，不压缩</span><br><span class="line">tar -zcvf /tmp/etc.tar.gz /etc // 打包以 gzip 压缩</span><br><span class="line">tar -jcvf /tmp/etc.tar.bz2 /etc // 打包以 bzip2 压缩</span><br><span class="line"></span><br><span class="line">tar -xvf /tmp/etc.tar	// 解包</span><br><span class="line">tar -zxvf /tmp/etc.tar.gz // 解压gzip包</span><br><span class="line">tar -jxvf /tmp/etc.tar.bz2 // 解压bzip2包</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="linux查看磁盘容量"><a href="#linux查看磁盘容量" class="headerlink" title="linux查看磁盘容量"></a>linux查看磁盘容量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -lh</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="CentOS永久设置静态路由"><a href="#CentOS永久设置静态路由" class="headerlink" title="CentOS永久设置静态路由"></a>CentOS永久设置静态路由</h3><p>查看路由表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route -n</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/static-routes</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">any net 0.0.0.0/0 gw 192.168.1.1</span><br><span class="line">any net 192.168.1.0/24 net mask 255.255.255.0 gw 192.168.1.1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="后台执行程序"><a href="#后台执行程序" class="headerlink" title="后台执行程序"></a>后台执行程序</h3><p>对于普通程序,启动命令后加 &amp;可以使程序后台运行,但是ssh连接关闭之后程序会停止运行,例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./startup.sh &amp;</span><br></pre></td></tr></table></figure></p>
<p>nohup命令使ssh连接断开之后程序依然在后台运行,例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./startup.sh &amp;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep java</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="显示文件内容"><a href="#显示文件内容" class="headerlink" title="显示文件内容"></a>显示文件内容</h3><h4 id="顺序输出文本文件内容"><a href="#顺序输出文本文件内容" class="headerlink" title="顺序输出文本文件内容"></a>顺序输出文本文件内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat [-AbEnTv] filename</span><br></pre></td></tr></table></figure>
<p>-E 换行显示$<br>-T tab显示为^I<br>-v 显示特殊字符<br>-n 打印行号，空行有行号<br>-b 打印行号，空行无行号</p>
<p>-A = -vET</p>
<h4 id="倒序输出文本文件内容"><a href="#倒序输出文本文件内容" class="headerlink" title="倒序输出文本文件内容"></a>倒序输出文本文件内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac filename</span><br></pre></td></tr></table></figure>
<h4 id="显示文本文件内容-可向后翻页"><a href="#显示文本文件内容-可向后翻页" class="headerlink" title="显示文本文件内容,可向后翻页"></a>显示文本文件内容,可向后翻页</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more filename</span><br></pre></td></tr></table></figure>
<p>空格键    向下翻页<br>Enter        向下翻一行<br>:f         显示文件名及目前行数<br>:q         退出<br>:b         往回翻<br>/字符串    向下搜索</p>
<h4 id="显示文本内容，可向前翻页"><a href="#显示文本内容，可向前翻页" class="headerlink" title="显示文本内容，可向前翻页"></a>显示文本内容，可向前翻页</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less filename</span><br></pre></td></tr></table></figure>
<p>空格键    向下翻页<br>pagedown    向下翻页<br>pageup    向上翻页<br>/字符串    向下搜索<br>?字符串    向上搜索</p>
<h4 id="显示文件前几行"><a href="#显示文件前几行" class="headerlink" title="显示文件前几行"></a>显示文件前几行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head [-n number] filename</span><br></pre></td></tr></table></figure>
<h4 id="显示后100行前的内容"><a href="#显示后100行前的内容" class="headerlink" title="显示后100行前的内容"></a>显示后100行前的内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head -n -100 filename</span><br></pre></td></tr></table></figure>
<h4 id="显示文件后几行"><a href="#显示文件后几行" class="headerlink" title="显示文件后几行"></a>显示文件后几行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail [-n number] filename</span><br></pre></td></tr></table></figure>
<h4 id="显示前100行以后的内容"><a href="#显示前100行以后的内容" class="headerlink" title="显示前100行以后的内容"></a>显示前100行以后的内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -n +100</span><br></pre></td></tr></table></figure>
<h4 id="持续检查并输出最后100行"><a href="#持续检查并输出最后100行" class="headerlink" title="持续检查并输出最后100行"></a>持续检查并输出最后100行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f -n 100 filename</span><br></pre></td></tr></table></figure>
<h2 id="ctrl-c-退出"><a href="#ctrl-c-退出" class="headerlink" title="ctrl + c 退出"></a>ctrl + c 退出</h2>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/CentOS/">CentOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/08/17/linux/linux常用命令记录/" title="linux常用命令" itemprop="url">linux常用命令</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2014-08-16T21:18:40.000Z" itemprop="datePublished"> 发表于 2014-08-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">开放端口11211</span><br><span class="line"># /sbin/iptables -I INPUT -p tcp --dport 11211 -j ACCEPT</span><br><span class="line">保存</span><br><span class="line"># /etc/rc.d/init.d/iptables save</span><br><span class="line">查看打开的端口：</span><br><span class="line"># /etc/init.d/iptables status</span><br><span class="line"></span><br><span class="line">关闭防火墙</span><br><span class="line"># /etc/init.d/iptables stop</span><br><span class="line">重启防火墙</span><br><span class="line"># /etc/init.d/iptables restart</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">查看IP</span><br><span class="line"># ifconfig eth0</span><br><span class="line">修改IP</span><br><span class="line"># /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">HWADDR=</span><br><span class="line">ONBOOT=yes</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">IPADDR=&lt;你的IP&gt;</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.0.1</span><br></pre></td></tr></table></figure>
<p>重启network服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure></p>
<p>配置DNS<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/resolv.conf</span><br><span class="line">nameserver 223.5.5.5</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="远程连接配置"><a href="#远程连接配置" class="headerlink" title="远程连接配置"></a>远程连接配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">使用SSH</span><br><span class="line"># vi /etc/ssh/sshd_config</span><br><span class="line">将Port,Protocol等注释去掉</span><br><span class="line">修改/etc/hosts.deny 在最后面添加一行：</span><br><span class="line">sshd:All</span><br><span class="line">修改/etc/hosts.allow 在最后面添加一行：</span><br><span class="line">sshd:All</span><br><span class="line">启动SSH</span><br><span class="line"># /etc/init.d/sshd start</span><br><span class="line">在防火墙中开放SSH使用的端口</span><br><span class="line">在Windows上使用PuTTY连接CentOS</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><p>删除文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf 文件名</span><br></pre></td></tr></table></figure></p>
<p>参数说明:<br>-rf r:recursion(递归),f:force(强制)</p>
<p>修改文件权限chmod<br>三种权限:<br>Read Write Execute<br>  1    1     1<br>r=4<br>w=2<br>x=1<br>rwx=7<br>rw=6</p>
<p>改变文件权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 761 temp.zip</span><br></pre></td></tr></table></figure></p>
<p>root的权限是 rwx（读写和执行权限），<br>所属用户组权限是 rw (只有读写权限)，<br>对于其它用户权限是 x(只有只执行权限)</p>
<p>递归改变目录权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 -R /usr/local/mydir</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="tar-命令-磁带归档-Tape-Archive"><a href="#tar-命令-磁带归档-Tape-Archive" class="headerlink" title="tar 命令,磁带归档(Tape Archive)"></a>tar 命令,磁带归档(Tape Archive)</h3><p>tar [-cxtzjvfpPN] 文件/目录</p>
<p>参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-c ：建立</span><br><span class="line">-x ：解压</span><br><span class="line">-t ：查看</span><br><span class="line"></span><br><span class="line">-z:	gzip</span><br><span class="line">-j: bzip2</span><br><span class="line">-v: 进度</span><br><span class="line">-f: 文档名</span><br><span class="line">-p: 属性不变</span><br><span class="line">-P: 使用绝对路径来压缩</span><br><span class="line">-N：比后面接的日期(yyyy/mm/dd)还要新的才会被打包进新建的文件中</span><br><span class="line">--exclude FILE：在压缩的过程中,排除FILE</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar -cvf /tmp/etc.tar /etc // 打包，不压缩</span><br><span class="line">tar -zcvf /tmp/etc.tar.gz /etc // 打包以 gzip 压缩</span><br><span class="line">tar -jcvf /tmp/etc.tar.bz2 /etc // 打包以 bzip2 压缩</span><br><span class="line"></span><br><span class="line">tar -xvf /tmp/etc.tar	// 解包</span><br><span class="line">tar -zxvf /tmp/etc.tar.gz // 解压gzip包</span><br><span class="line">tar -jxvf /tmp/etc.tar.bz2 // 解压bzip2包</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="linux查看磁盘容量"><a href="#linux查看磁盘容量" class="headerlink" title="linux查看磁盘容量"></a>linux查看磁盘容量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -lh</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="CentOS永久设置静态路由"><a href="#CentOS永久设置静态路由" class="headerlink" title="CentOS永久设置静态路由"></a>CentOS永久设置静态路由</h3><p>查看路由表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route -n</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/static-routes</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">any net 0.0.0.0/0 gw 192.168.1.1</span><br><span class="line">any net 192.168.1.0/24 net mask 255.255.255.0 gw 192.168.1.1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="后台执行程序"><a href="#后台执行程序" class="headerlink" title="后台执行程序"></a>后台执行程序</h3><p>对于普通程序,启动命令后加 &amp;可以使程序后台运行,但是ssh连接关闭之后程序会停止运行,例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./startup.sh &amp;</span><br></pre></td></tr></table></figure></p>
<p>nohup命令使ssh连接断开之后程序依然在后台运行,例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./startup.sh &amp;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep java</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="显示文件内容"><a href="#显示文件内容" class="headerlink" title="显示文件内容"></a>显示文件内容</h3><h4 id="顺序输出文本文件内容"><a href="#顺序输出文本文件内容" class="headerlink" title="顺序输出文本文件内容"></a>顺序输出文本文件内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat [-AbEnTv] filename</span><br></pre></td></tr></table></figure>
<p>-E 换行显示$<br>-T tab显示为^I<br>-v 显示特殊字符<br>-n 打印行号，空行有行号<br>-b 打印行号，空行无行号</p>
<p>-A = -vET</p>
<h4 id="倒序输出文本文件内容"><a href="#倒序输出文本文件内容" class="headerlink" title="倒序输出文本文件内容"></a>倒序输出文本文件内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac filename</span><br></pre></td></tr></table></figure>
<h4 id="显示文本文件内容-可向后翻页"><a href="#显示文本文件内容-可向后翻页" class="headerlink" title="显示文本文件内容,可向后翻页"></a>显示文本文件内容,可向后翻页</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more filename</span><br></pre></td></tr></table></figure>
<p>空格键    向下翻页<br>Enter        向下翻一行<br>:f         显示文件名及目前行数<br>:q         退出<br>:b         往回翻<br>/字符串    向下搜索</p>
<h4 id="显示文本内容，可向前翻页"><a href="#显示文本内容，可向前翻页" class="headerlink" title="显示文本内容，可向前翻页"></a>显示文本内容，可向前翻页</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less filename</span><br></pre></td></tr></table></figure>
<p>空格键    向下翻页<br>pagedown    向下翻页<br>pageup    向上翻页<br>/字符串    向下搜索<br>?字符串    向上搜索</p>
<h4 id="显示文件前几行"><a href="#显示文件前几行" class="headerlink" title="显示文件前几行"></a>显示文件前几行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head [-n number] filename</span><br></pre></td></tr></table></figure>
<h4 id="显示后100行前的内容"><a href="#显示后100行前的内容" class="headerlink" title="显示后100行前的内容"></a>显示后100行前的内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head -n -100 filename</span><br></pre></td></tr></table></figure>
<h4 id="显示文件后几行"><a href="#显示文件后几行" class="headerlink" title="显示文件后几行"></a>显示文件后几行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail [-n number] filename</span><br></pre></td></tr></table></figure>
<h4 id="显示前100行以后的内容"><a href="#显示前100行以后的内容" class="headerlink" title="显示前100行以后的内容"></a>显示前100行以后的内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -n +100</span><br></pre></td></tr></table></figure>
<h4 id="持续检查并输出最后100行"><a href="#持续检查并输出最后100行" class="headerlink" title="持续检查并输出最后100行"></a>持续检查并输出最后100行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f -n 100 filename</span><br></pre></td></tr></table></figure>
<h2 id="ctrl-c-退出"><a href="#ctrl-c-退出" class="headerlink" title="ctrl + c 退出"></a>ctrl + c 退出</h2>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/linux/">linux</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/07/29/spring/spring-mvc编码设置/" title="spring mvc编码设置" itemprop="url">spring mvc编码设置</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2014-07-29T11:39:22.000Z" itemprop="datePublished"> 发表于 2014-07-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>在web.xml里添加filter来指定解析表单提交信息时采用的编码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">		org.springframework.web.filter.CharacterEncodingFilter</span><br><span class="line">	<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/spring/">spring</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/03/27/spring/spring-quartz配置/" title="spring quartz配置" itemprop="url">spring quartz配置</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2014-03-27T13:18:06.000Z" itemprop="datePublished"> 发表于 2014-03-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>applicationContext-quartz.xml配置文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:jee</span>=<span class="string">"http://www.springframework.org/schema/jee"</span></span><br><span class="line">	<span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span><br><span class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"</span><br><span class="line">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd </span><br><span class="line">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd </span><br><span class="line">		http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.5.xsd </span><br><span class="line">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd</span><br><span class="line">		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"</span></span><br><span class="line">	<span class="attr">default-autowire</span>=<span class="string">"no"</span> <span class="attr">default-lazy-init</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"quartzScheduler"</span></span><br><span class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"triggers"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"soundPlayCountUpdateTrigger"</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"soundPlayCountUpdateTrigger"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.CronTriggerBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span> <span class="attr">ref</span>=<span class="string">"soundPlayCountUpdate"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cronExpression"</span> <span class="attr">value</span>=<span class="string">"0 0/1 * * * ?"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"soundPlayCountUpdate"</span></span><br><span class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetObject"</span> <span class="attr">ref</span>=<span class="string">"soundService"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetMethod"</span> <span class="attr">value</span>=<span class="string">"updatePlayCount"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"concurrent"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果MethodInvokingJobDetailFactoryBean的targetObject属性的值不是引用在xml中配置的bean,而是引用自动装配的bean时,<br>需要将applicationContext-quartz.xml的default-autowire=”no”</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/spring/">spring</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/12/24/oracle/oracle设置账户密码永不过期/" title="oracle设置账户密码永不过期" itemprop="url">oracle设置账户密码永不过期</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2013-12-23T17:43:13.000Z" itemprop="datePublished"> 发表于 2013-12-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>1.查看用户的proifle<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> USERNAME,PROFILE <span class="keyword">FROM</span> DBA_USERS;</span><br></pre></td></tr></table></figure></p>
<p>2.查看proifle密码有效期设置<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> DBA_PROFILES <span class="keyword">WHERE</span> PROFILE=<span class="string">'DEFAULT'</span> <span class="keyword">AND</span> RESOURCE_NAME=<span class="string">'PASSWORD_LIFE_TIME'</span>;</span><br></pre></td></tr></table></figure></p>
<p>3.密码有效期改为无限<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> PROFILE <span class="keyword">DEFAULT</span> <span class="keyword">LIMIT</span> PASSWORD_LIFE_TIME <span class="keyword">UNLIMITED</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果账户提示锁定<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> XIAOMING <span class="keyword">ACCOUNT</span> <span class="keyword">UNLOCK</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果账户仍然提示过期,重置账户密码<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> XIAOMING <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> PWD12345;</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/oracle/">oracle</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/11/14/oracle/oracle定时任务/" title="oracle定时任务" itemprop="url">oracle定时任务</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2013-11-13T17:03:47.000Z" itemprop="datePublished"> 发表于 2013-11-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>DBMS_JOB系统包是Oracle“任务队列”子系统的API编程接口。<br>DBMS_JOB包对于任务队列提供了下面这些功能：提交并且执行一个任务、改变任务的执行参数以及删除或者临时挂起任务等。<br>DBMS_JOB包是由ORACLE_HOME目录下的rdbms/admin子目录下的DBMSJOB.SQL和PRVTJOB.PLB 这两个脚本文件创建的。<br>这两个文件被CATPROC.SQL脚本文件调用，而CATPROC.SQL这个文件一般是在数据库创建后立即执行的。<br>脚本为DBMS_JOB包创建了一个公共同义词，并给该包授予了公共的可执行权限，所以所有的Oracle用户均可以使用这个包。</p>
<p>下面几个数据字典视图是关于任务队列信息的，主要有DBA_JOBS, USER_JOBS和DBA_JOBS_RUNNING。<br>这些字典视图是由名为CATJOBQ.SQL的脚本文件创建的。该脚本文件和创建DBMS_JOB包的脚本文件一样在ORACLE_HOME目录的rdbms/admin子目录中，同样也是由脚本文件CATPROC.SQL调用。<br>最后，要使任务队列能正常运行，还必须启动它自己专有的后台过程。<br>启动后台过程是通过在初始化文件init*.ora(实例不同，初始化文件名也略有不同)中设置初始化参数来进行的。下面就是该参数：<br>JOB_QUEUE_PROCESSES = n<br>其中，n可以是0到36之间的任何一个数。除了该参数以外，还有几个关于任务队列的初始化参数，本文后面将会对其进行详细讨论。<br>DBMS_JOB包中包含有许多过程，见表1所示。</p>
<p><strong>表1 DBMS_JOB包</strong><br>名称    类型    描述<br>DBMS_JOB.ISUBMIT    过程    提交一个新任务，用户指定一个任务号<br>DBMS_JOB.SUBMIT    过程    提交一个新任务，系统指定一个任务号<br>DBMS_JOB.REMOVE    过程    从队列中删除一个已经存在的任务<br>DBMS_JOB.CHANGE    过程    更改用户设定的任务参数<br>DBMS_JOB.WHAT    过程    更改PL/SQL任务定义<br>DBMS_JOB.NEXT_DATE    过程    更改任务下一次运行时间<br>DBMS_JOB.INTERVAL    过程    更改任务运行的时间间隔<br>DBMS_JOB.BROKEN    过程    将任务挂起，不让其重复运行<br>DBMS_JOB.RUN    过程    在当前会话中立即执行任务<br>DBMS_JOB.USER_EXPORT    过程    创建文字字符串，用于重新创建一个任务</p>
<p><strong>三、DBMS_JOB包参数</strong><br>DBMS_JOB包中所有的过程都有一组相同的公共参数，用于定义任务，任务的运行时间以及任务定时运行的时间间隔。<br>这些公共任务定义参数见表2所示。</p>
<p><strong>表2 DBMS_JOB过程的公共参数</strong><br>名称    类型    注释<br>Job    BINARY_INTEGER    任务的唯一识别号<br>What    VARCHAR2    作为任务执行的PL/SQL代码<br>Next_date    VARCHAR2    任务下一次运行的时间<br>Interval    VARCHAR2    日期表达式，用来计算下一次任务运行的时间</p>
<p>下面我们来详细讨论这些参数的意义及用法。<br><strong>1、job</strong><br>参数job是一个整数，用来唯一地标示一个任务。该参数既可由用户指定也可由系统自动赋予，这完全取决于提交任务时选用了那一个任务提交过程。DBMS_JOB.SUBMIT过程通过获得序列SYS.JOBSEQ的下一个值来自动赋予一个任务号。<br>该任务号是作为一个OUT参数返回的，所以调用者随后可以识别出提交的任务。而DBMS_JOB.ISUBMIT过程则由调用者给任务指定一个识别号，这时候，任务号的唯一性就完全取决于调用者了。<br>除了删除或者重新提交任务，一般来说任务号是不能改变的。即使当数据库被导出或者被导入这样极端的情况，任务号也将被保留下来。<br>所以在执行含有任务的数据的导入/导出操作时很可能会发生任务号冲突的现象。</p>
<p><strong>2、what</strong><br>what参数是一个可以转化为合法PL/SQL调用的字符串，该调用将被任务队列自动执行。<br>在what参数中，如果使用文字字符串，则该字符串必须用单引号括起来。 what参数也可以使用包含我们所需要字符串值的VARCHAR2变量。<br>实际的PL/SQL调用必须用分号隔开。在PL/SQL调用中如果要嵌入文字字符串，则必须使用两个单引号。<br>what参数的长度在Oracle7.3中限制在2000个字节以内，在Oracle 8.0以后，扩大到了4000个字节，这对于一般的应用已完全足够。<br>该参数的值一般情况下都是对一个PL/SQL存储过程的调用。在实际应用中，尽管可以使用大匿名Pl/SQL块，但建议大家最好不要这样使用。<br>还有一个实际经验就是最好将存储过程调用封装在一个匿名块中，这样可以避免一些比较莫名错误的产生。<br>我来举一个例子，一般情况下，what参数可以这样引用：<br>what =&gt;’my_procedure(parameter1);’<br>但是比较安全的引用，应该这样写：<br>what =&gt;’begin my_procedure(parameter1); end;’<br>任何时候，我们只要通过更改what参数就可以达到更改任务定义的目的。<br>但是有一点需要注意，通过改变what参数来改变任务定义时，用户当前的会话设置也被记录下来并成为任务运行环境的一部分。<br>如果当前会话设置和最初提交任务时的会话设置不同，就有可能改变任务的运行行为。<br>意识到这个潜在的副作用是非常重要的，无论何时只要应用到任何DBMS_JOB过程中的what参数时就一定要确保会话设置的正确。</p>
<p><strong>3、next_date</strong><br>Next_date参数是用来调度任务队列中该任务下一次运行的时间。这个参数对于DBMS_JOB.SUBMIT和DBMS_JOB.BROKEN这两个过程确省为系统当前时间，也就是说任务将立即运行。<br>当将一个任务的next_date参数赋值为null时，则该任务下一次运行的时间将被指定为4000年1月1日，也就是说该任务将永远不再运行。<br>在大多数情况下，这可能是我们不愿意看到的情形。但是，换一个角度来考虑，如果想在任务队列中保留该任务而又不想让其运行，将next_date设置为null却是一个非常简单的办法。Next_date也可以设置为过去的一个时间。<br>这里要注意，系统任务的执行顺序是根据它们下一次的执行时间来确定的，于是将next_date参数设置回去就可以达到将该任务排在任务队列前面的目的。<br>这在任务队列进程不能跟上将要执行的任务并且一个特定的任务需要尽快执行时是非常有用的。</p>
<p><strong>4、Interval</strong><br>Internal参数是一个表示Oracle合法日期表达式的字符串。<br>这个日期字符串的值在每次任务被执行时算出，算出的日期表达式有两种可能，要么是未来的一个时间要么就是null。<br>这里要强调一点：很多开发者都没有意识到next_date是在一个任务开始时算出的，而不是在任务成功完成时算出的。<br>当任务成功完成时，系统通过更新任务队列目录表将前面算出的next_date值置为下一次任务要运行的时间。<br>当由interval表达式算出next_date是null时，任务自动从任务队列中移出，不会再继续执行。<br>因此，如果传递一个null值给interval参数，则该任务仅仅执行一次。<br>通过给interval参数赋各种不同的值，可以设计出复杂运行时间计划的任务。本文后面的“任务间隔和日期算法”将对interval表达式进行详细讨论，并给出一个实际有用interval表达式的例子。</p>
<p><strong>四、任务队列架构和运行环境</strong><br>任务队列在Oracle系统中其实是一个子系统，它具有自己特定的后台过程和目录表。<br>该子系统设计的目的是为了能不在用户干预下自动运行PL/SQL过程。</p>
<p><strong>1、任务队列后台过程</strong><br>任务队列（SNP）后台过程随着Oracle实例的启动而同时启动。<br>在文章前面已经谈到初始化文件init.ora中的参数JOB_QUEUE_PROCESSES，用来设置有几个队列过程。<br>这里设置了几个过程，系统中就会有几个SNP过程被启动。JOB_QUEUE_PROCESSES这个参数，可以是0到36中的任何一个数，也就是说对于每个Oracle实例最多可以有36个SNP过程，也可以不支持队列过程（＝0）。<br>在大多数操作系统中，SNP三个字母常作为过程名的一部分出现。如，在unix系统中，如果该Oracle实例名为ora8，有三个任务队列过程，则这三个任务队列过程名称为：<br>ora_ora8_snp0<br>ora_ora8_snp1<br>ora_ora8_snp2<br>SNP后台过程和其他的Oracle后台过程的一个重要区别就是杀掉一个SNP过程不会影响到Oracle实例。<br>当一个任务队列过程失控或者消耗太多的资源时，就可以将其杀掉，当然这种情况不是经常遇到的。<br>当一个SNP过程被杀掉或者失败时，Oracle就自动启动一个新的SNP过程来代替它。<br><strong><br>2、有关任务队列的初始化参数</strong><br>初始化文件init.ora中的几个参数控制着任务队列后台的运行，下面我们将对其进行详细讨论。<br>（1）、JOB_QUEUE_INTERVAL<br>任务队列过程定期唤醒并检查任务队列目录表是否有任务需要执行。参数JOB_QUEUE_INTERVAL决定SNP过程两次检查目录表之间“休眠”多长时间（单位为秒）。<br>间隔设的太小会造成由于SNP过程不断检查目录表而导致不必要的系统吞吐量。相反如果间隔设得太大，SNP过程在特定的时间没有被唤醒，那个时间的任务就不会能被运行。<br>最佳的时间间隔设置要综合考虑系统环境中不同的任务，60秒的确省设置可以满足大多数的应用。</p>
<p>（2）、JOB_QUEUE_KEEP_CONNECTIONS<br>除了前面介绍的JOB_QUEUE_PROCESS和JOB_QUEUE_INTERVAL两个参数以外，影响SNP后台过程行为的第三个参数是JOB_QUEUE_KEEP_CONNECTIONS。当该参数为TRUE时，SNP过程在两个任务的运行期间（也就是休眠期间），仍然和Oracle保持开放的连接。相反，如果为FALSE时，SNP过程将和数据库断开连接，当唤醒时刻到来时又重新连接并检查任务队列。<br>选择这两种方法中的那一种，主要是考虑任务队列的有效性和数据库关闭方法。长期保持连接的效率比较高，但任务队列会受到正常关闭数据库的影响。<br>这是因为任务队列过程对于服务器管理器看来和一个普通用户的过程没有什么不同，而正常的关闭数据库需要让所有的用户都断开连接。而断开连接和重新连接又给数据库增加了负荷，但是可定期地使数据库没有可连接SNP过程，也就可以使数据库正常关闭。<br>对于有很多任务或者是任务重复执行的时间间隔较短（一个小时或者更少）的环境，一般将JOB_QUEUE_KEEP_CONNECTIOONS设置为TRUE，并修改关闭数据库的脚本为立即关闭。<br>对于严格要求采用正常方式关闭的数据库或者是任务较少，重复间隔较长的环境，一般将该参数设置为FALSE。最好，要提醒一句，SNP过程仅在没有任何任务运行时才断开，这种情况下，那些需要比较长时间运行的任务SNP将在它们的生命周期内一致保持开放的连接，这就延迟了正常关闭数据库的时间。</p>
<p><strong>3、建立运行环境</strong><br>当SNP过程唤醒时，它首先查看任务队列目录中所有的任务是否当前的时间超过了下一次运行的日期时间。SNP检测到需要该时间立即执行的任务后，这些任务按照下一次执行日期的顺序依次执行。当SNP过程开始执行一个任务时，其过程如下：</p>
<ol>
<li>以任务所有者的用户名开始一个新的数据库会话。</li>
<li>当任务第一次提交或是最后一次被修改时，更改会话NLS设置和目前就绪的任务相匹配。</li>
<li>通过interval日期表达式和系统时间，计算下一次执行时间。</li>
<li>执行任务定义的PL/SQL</li>
<li>如果运行成功，任务的下一次执行日期（next_date）被更新，否则，失败计数加1。</li>
<li>经过JOB_QUEUS_INTERVAL秒后，又到了另一个任务的运行时间，重复上面的过程。<br>在前两步中，SNP过程创建了一个模仿用户运行任务定义的PL/SQL的会话环境。<br>然而，这个模仿的运行环境并不是和用户实际会话环境完全一样，需要注意以下两点：<br>第一，在任务提交时任何可用的非确省角色都将在任务运行环境中不可用。因此，那些想从非确省角色中取得权限的任务不能提交，用户确省角色的修改可以通过在任务未来运行期间动态修改来完成。<br>第二，任何任务定义本身或者过程执行中需要的数据库联接都必须完全满足远程的用户名和密码。SNP过程不能在没有显式指明口令的情况下初始化一个远程会话。显然，SNP过程不能假定将本地用户的口令作为远程运行环境会话设置的一部分。<br>提交的任务如果运行失败会怎么样呢？当任务运行失败时，SNP过程在1分钟后将再次试图运行该任务。<br>如果这次运行又失败了，下一次尝试将在2分钟后进行，再下一次在4分钟以后。任务队列每次加倍重试间隔直到它超过了正常的运行间隔。<br>在连续16次失败后，任务就被标记为中断的（broken），如果没有用户干预，任务队列将不再重复执行。</li>
</ol>
<p><strong>五、任务队列字典表和视图</strong><br>任务队列中的任务信息可以通过表3所示的几个字典视图来查看，这些视图是由CATJOBQ.sql脚本创建的。表4和5是各个视图每个字段的含义。</p>
<p>表3. 任务队列中关于任务的数据字典视图<br>视图名    描述<br>DBA_JOBS    本数据库中定义到任务队列中的任务<br>DBA_JOBS_RUNNING    目前正在运行的任务<br>USER_JOBS    当前用户拥有的任务</p>
<p>表4. DBA_JOBS 和 USER_JOBS.字典视图的字段含义<br>字段（列）    类型    描述<br>JOB    NUMBER    任务的唯一标示号<br>LOG_USER    VARCHAR2(30)    提交任务的用户<br>PRIV_USER    VARCHAR2(30)    赋予任务权限的用户<br>SCHEMA_USER    VARCHAR2(30)    对任务作语法分析的用户模式<br>LAST_DATE    DATE    最后一次成功运行任务的时间<br>LAST_SEC    VARCHAR2(8)    如HH24:MM:SS格式的last_date日期的小时，分钟和秒<br>THIS_DATE    DATE    正在运行任务的开始时间，如果没有运行任务则为null<br>THIS_SEC    VARCHAR2(8)    如HH24:MM:SS格式的this_date日期的小时，分钟和秒<br>NEXT_DATE    DATE    下一次定时运行任务的时间<br>NEXT_SEC    VARCHAR2(8)    如HH24:MM:SS格式的next_date日期的小时，分钟和秒<br>TOTAL_TIME    NUMBER    该任务运行所需要的总时间，单位为秒<br>BROKEN    VARCHAR2(1)    标志参数，Y标示任务中断，以后不会运行<br>INTERVAL    VARCHAR2(200)    用于计算下一运行时间的表达式<br>FAILURES    NUMBER    任务运行连续没有成功的次数<br>WHAT    VARCHAR2(2000)    执行任务的PL/SQL块<br>CURRENT_SESSION_LABEL    RAW MLSLABEL    该任务的信任Oracle会话符<br>CLEARANCE_HI    RAW MLSLABEL    该任务可信任的Oracle最大间隙<br>CLEARANCE_LO    RAW MLSLABEL    该任务可信任的Oracle最小间隙<br>NLS_ENV    VARCHAR2(2000)    任务运行的NLS会话设置<br>MISC_ENV    RAW(32)    任务运行的其他一些会话参数</p>
<p>表 5. 视图DBA_JOBS_RUNNING的字段含义<br>列    数据类型    描述<br>SID    NUMBER    目前正在运行任务的会话ID<br>JOB    NUMBER    任务的唯一标示符<br>FAILURES    NUMBER    连续不成功执行的累计次数<br>LAST_DATE    DATE    最后一次成功执行的日期<br>LAST_SEC    VARCHAR2(8)    如HH24:MM:SS格式的last_date日期的小时，分钟和秒<br>THIS_DATE    DATE    目前正在运行任务的开始日期<br>THIS_SEC    VARCHAR2(8)    如HH24:MM:SS格式的this_date日期的小时，分钟和秒</p>
<p><strong>六、任务重复运行间隔和间隔设计算法</strong><br>任务重复运行的时间间隔取决于interval参数中设置的日期表达式。下面就来详细谈谈该如何设置interval参数才能准确满足我们的任务需求。<br>一般来讲，对于一个任务的定时执行，有三种定时要求。</p>
<ol>
<li>在一个特定的时间间隔后，重复运行该任务。</li>
<li>在特定的日期和时间运行任务。</li>
<li>任务成功完成后，下一次执行应该在一个特定的时间间隔之后。<br>第一种调度任务需求的日期算法比较简单，即’SYSDATE+n’,这里n是一个以天为单位的时间间隔。表6给出了一些这种时间间隔设置的例子。</li>
</ol>
<p>表6 一些简单的interval参数设置例子<br>描述    Interval参数值<br>每天运行一次    ‘SYSDATE + 1’<br>每小时运行一次    ‘SYSDATE + 1/24’<br>每10分钟运行一次    ‘SYSDATE + 10/（60<em>24）’<br>每30秒运行一次    ‘SYSDATE + 30/(60</em>24*60)’<br>每隔一星期运行一次    ‘SYSDATE + 7’<br>不再运行该任务并删除它    NULL</p>
<p>表6所示的任务间隔表达式不能保证任务的下一次运行时间在一个特定的日期或者时间，仅仅能够指定一个任务两次运行之间的时间间隔。<br>例如，如果一个任务第一次运行是在凌晨12点，interval指定为’SYSDATE + 1’,则该任务将被计划在第二天的凌晨12点执行。<br>但是，如果某用户在下午4点手工（DBMS_JOB.RUN）执行了该任务，那么该任务将被重新定时到第二天的下午4点。还有一个可能的原因是如果数据库关闭或者说任务队列非常的忙以至于任务不能在计划的那个时间点准时执行。<br>在这种情况下，任务将试图尽快运行，也就是说只要数据库一打开或者是任务队列不忙就开始执行，但是这时，运行时间已经从原来的提交时间漂移到了后来真正的运行时间。这种下一次运行时间的不断“漂移”是采用简单时间间隔表达式的典型特征。<br>第二种调度任务需求相对于第一种就需要更复杂的时间间隔（interval）表达式，表7是一些要求在特定的时间运行任务的interval设置例子。</p>
<p>表 7. 定时到特定日期或时间的任务例子<br>描述    INTERVAL参数值<br>每天午夜12点    ‘TRUNC(SYSDATE + 1)’<br>每天早上8点30分    ‘TRUNC(SYSDATE + 1) + （8<em>60+30）/(24</em>60)’<br>每星期二中午12点    ‘NEXT_DAY(TRUNC(SYSDATE ), ‘’TUESDAY’’ ) + 12/24’<br>每个月第一天的午夜12点    ‘TRUNC(LAST_DAY(SYSDATE ) + 1)’<br>每个季度最后一天的晚上11点    ‘TRUNC(ADD_MONTHS(SYSDATE + 2/24, 3 ), ‘Q’ ) -1/24’<br>每星期六和日早上6点10分    ‘TRUNC(LEAST(NEXT_DAY(SYSDATE, ‘’SATURDAY”), NEXT_DAY(SYSDATE, “SUNDAY”))) + （6×60+10）/（24×60）’<br>第三种调度任务需求无论通过怎样设置interval日期表达式也不能满足要求。<br>这时因为一个任务的下一次运行时间在任务开始时才计算，而在此时是不知道任务在何时结束的。遇到这种情况怎么办呢？<br>当然办法肯定是有的，我们可以通过为任务队列写过程的办法来实现。<br>这里我只是简单介绍以下，可以在前一个任务队列执行的过程中，取得任务完成的系统时间，然后加上指定的时间间隔，拿这个时间来控制下一个要执行的任务。这里有一个前提条件，就是目前运行的任务本身必须要严格遵守自己的时间计划。<br>结论<br>Oracle中的定时任务是在Oracle系统中是一个非常重要的子系统，运用得当，可以极大的提高我们的系统运行和维护能力。<br>而Oracle数据复制的延迟事务队列管理完全是基于Oracle的队列任务，对其的深刻理解有助于我们更好地管理数据复制。</p>
<p>源自:<a href="http://wenku.baidu.com/link?url=LO9ow8-fW855b-3Ya6nW2aD6EzCt0Wu_lRyssyEbfrUUikbtNje-H2_OwPiO6fUROqwD6cBKKAL9dsZNA62iALs5TKdRd5UphsxKpPZ_QO7" title="http://wenku.baidu.com/link?url=LO9ow8-fW855b-3Ya6nW2aD6EzCt0Wu_lRyssyEbfrUUikbtNje-H2_OwPiO6fUROqwD6cBKKAL9dsZNA62iALs5TKdRd5UphsxKpPZ_QO7" target="_blank" rel="external">http://wenku.baidu.com/link?url=LO9ow8-fW855b-3Ya6nW2aD6EzCt0Wu_lRyssyEbfrUUikbtNje-H2_OwPiO6fUROqwD6cBKKAL9dsZNA62iALs5TKdRd5UphsxKpPZ_QO7</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/oracle/">oracle</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/09/09/mybatis/mybatis-批量保存/" title="mybatis批量保存" itemprop="url">mybatis批量保存</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2013-09-09T04:08:38.000Z" itemprop="datePublished"> 发表于 2013-09-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>传入参数为List的时候集合的名称collection=”list”<br>传入参数为数组的时候集合的名称collection=”array”</p>
<p>mybatis将参数装入map中，当参数类型为List时，”list”作为key，List类型的参数作为val</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id="batchAdd" parameterType="ArrayList"&gt;</span><br><span class="line">	&lt;foreach collection="list" item="suggest"&gt;</span><br><span class="line">   		INSERT INTO [T_Suggest]</span><br><span class="line">		           ([phonenum],[email],[suggestContent],[suggestTime],[state])</span><br><span class="line">		     VALUES</span><br><span class="line">		           (#&#123;suggest.phonenum&#125;,#&#123;suggest.email&#125;,#&#123;suggest.suggestContent&#125;,#&#123;suggest.suggestTime&#125;,#&#123;suggest.state&#125;)</span><br><span class="line">	&lt;/foreach&gt;</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/mybatis/">mybatis</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/08/14/mybatis/mybatis-example-jpetstore/" title="MyBatis Example:JPetStore" itemprop="url">MyBatis Example:JPetStore</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2013-08-13T16:28:38.000Z" itemprop="datePublished"> 发表于 2013-08-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="http://code.google.com/p/mybatis/下载JPetStore,了解下MyBatis怎么使用" target="_blank" rel="external">http://code.google.com/p/mybatis/下载JPetStore,了解下MyBatis怎么使用</a>.<br>JPetStore源代码包结构大体如下:<br>–domain<br>–persistence<br>–service<br>–web</p>
<p>说明:<br>domain: 只包含属性和get,set方法的bean对象<br>persistence: 包含数据访问接口,类名字以Mapper结尾<br>service: 业务逻辑层<br>web: action层</p>
<p>spring配置信息:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!--</span><br><span class="line">    Copyright 2010 The myBatis Team</span><br><span class="line"></span><br><span class="line">    Licensed under the Apache License, Version 2.0 (the "License");</span><br><span class="line">    you may not use this file except in compliance with the License.</span><br><span class="line">    You may obtain a copy of the License at</span><br><span class="line"></span><br><span class="line">        http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"></span><br><span class="line">    Unless required by applicable law or agreed to in writing, software</span><br><span class="line">    distributed under the License is distributed on an "AS IS" BASIS,</span><br><span class="line">    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line">    See the License for the specific language governing permissions and</span><br><span class="line">    limitations under the License.</span><br><span class="line">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">     <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">     <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span><br><span class="line">     <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span><br><span class="line">     <span class="attr">xmlns:jdbc</span>=<span class="string">"http://www.springframework.org/schema/jdbc"</span></span><br><span class="line">     <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">     <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span><br><span class="line">     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd</span><br><span class="line">     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span><br><span class="line">     http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd</span><br><span class="line">     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span><br><span class="line">     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- in-memory database and a datasource --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbc:embedded-database</span> <span class="attr">id</span>=<span class="string">"dataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">"classpath:database/jpetstore-hsqldb-schema.sql"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">"classpath:database/jpetstore-hsqldb-dataload.sql"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- transaction manager, use JtaTransactionManager for global tx --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- enable component scanning (beware that this does not enable mapper scanning!) --&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.mybatis.jpetstore.service"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- enable autowire --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- enable transaction demarcation with annotations --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- define the SqlSessionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"org.mybatis.jpetstore.domain"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- scan for mappers and let them be autowired --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"org.mybatis.jpetstore.persistence"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>52-55: sqlSessionFactory有两个属性dataSource和domain包名<br>58-60: MapperScannerConfigurer类的basePackage属性指定了Mapper所在包,即persistence包</p>
<p><strong> Mapper: </strong><br>org.mybatis.jpetstore.persistence.AccountMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.jpetstore.persistence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.jpetstore.domain.Account;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function">Account <span class="title">getAccountByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">Account <span class="title">getAccountByUsernameAndPassword</span><span class="params">(Account account)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">insertAccount</span><span class="params">(Account account)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">insertProfile</span><span class="params">(Account account)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">insertSignon</span><span class="params">(Account account)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">updateAccount</span><span class="params">(Account account)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">updateProfile</span><span class="params">(Account account)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">updateSignon</span><span class="params">(Account account)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong> Mapper.xml: </strong><br>orgmybatisjpetstorepersistenceAccountMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" </span><br><span class="line">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"org.mybatis.jpetstore.persistence.AccountMapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">cache</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAccountByUsername"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">          SIGNON.USERNAME,</span><br><span class="line">          ACCOUNT.EMAIL,</span><br><span class="line">          ACCOUNT.FIRSTNAME,</span><br><span class="line">          ACCOUNT.LASTNAME,</span><br><span class="line">          ACCOUNT.STATUS,</span><br><span class="line">          ACCOUNT.ADDR1 AS address1,</span><br><span class="line">          ACCOUNT.ADDR2 AS address2,</span><br><span class="line">          ACCOUNT.CITY,</span><br><span class="line">          ACCOUNT.STATE,</span><br><span class="line">          ACCOUNT.ZIP,</span><br><span class="line">          ACCOUNT.COUNTRY,</span><br><span class="line">          ACCOUNT.PHONE,</span><br><span class="line">          PROFILE.LANGPREF AS languagePreference,</span><br><span class="line">          PROFILE.FAVCATEGORY AS favouriteCategoryId,</span><br><span class="line">          PROFILE.MYLISTOPT AS listOption,</span><br><span class="line">          PROFILE.BANNEROPT AS bannerOption,</span><br><span class="line">          BANNERDATA.BANNERNAME</span><br><span class="line">    FROM ACCOUNT, PROFILE, SIGNON, BANNERDATA</span><br><span class="line">    WHERE ACCOUNT.USERID = #&#123;username&#125;</span><br><span class="line">      AND SIGNON.USERNAME = ACCOUNT.USERID</span><br><span class="line">      AND PROFILE.USERID = ACCOUNT.USERID</span><br><span class="line">      AND PROFILE.FAVCATEGORY = BANNERDATA.FAVCATEGORY</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAccountByUsernameAndPassword"</span> <span class="attr">parameterType</span>=<span class="string">"Account"</span> <span class="attr">resultType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">      SIGNON.USERNAME,</span><br><span class="line">      ACCOUNT.EMAIL,</span><br><span class="line">      ACCOUNT.FIRSTNAME,</span><br><span class="line">      ACCOUNT.LASTNAME,</span><br><span class="line">      ACCOUNT.STATUS,</span><br><span class="line">      ACCOUNT.ADDR1 AS address1,</span><br><span class="line">      ACCOUNT.ADDR2 AS address2,</span><br><span class="line">      ACCOUNT.CITY,</span><br><span class="line">      ACCOUNT.STATE,</span><br><span class="line">      ACCOUNT.ZIP,</span><br><span class="line">      ACCOUNT.COUNTRY,</span><br><span class="line">      ACCOUNT.PHONE,</span><br><span class="line">      PROFILE.LANGPREF AS languagePreference,</span><br><span class="line">      PROFILE.FAVCATEGORY AS favouriteCategoryId,</span><br><span class="line">      PROFILE.MYLISTOPT AS listOption,</span><br><span class="line">      PROFILE.BANNEROPT AS bannerOption,</span><br><span class="line">      BANNERDATA.BANNERNAME</span><br><span class="line">    FROM ACCOUNT, PROFILE, SIGNON, BANNERDATA</span><br><span class="line">    WHERE ACCOUNT.USERID = #&#123;username&#125;</span><br><span class="line">      AND SIGNON.PASSWORD = #&#123;password&#125;</span><br><span class="line">      AND SIGNON.USERNAME = ACCOUNT.USERID</span><br><span class="line">      AND PROFILE.USERID = ACCOUNT.USERID</span><br><span class="line">      AND PROFILE.FAVCATEGORY = BANNERDATA.FAVCATEGORY</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateAccount"</span> <span class="attr">parameterType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">    UPDATE ACCOUNT SET</span><br><span class="line">      EMAIL = #&#123;email&#125;,</span><br><span class="line">      FIRSTNAME = #&#123;firstName&#125;,</span><br><span class="line">      LASTNAME = #&#123;lastName&#125;,</span><br><span class="line">      STATUS = #&#123;status&#125;,</span><br><span class="line">      ADDR1 = #&#123;address1&#125;,</span><br><span class="line">      ADDR2 = #&#123;address2,jdbcType=VARCHAR&#125;,</span><br><span class="line">      CITY = #&#123;city&#125;,</span><br><span class="line">      STATE = #&#123;state&#125;,</span><br><span class="line">      ZIP = #&#123;zip&#125;,</span><br><span class="line">      COUNTRY = #&#123;country&#125;,</span><br><span class="line">      PHONE = #&#123;phone&#125;</span><br><span class="line">    WHERE USERID = #&#123;username&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertAccount"</span> <span class="attr">parameterType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">    INSERT INTO ACCOUNT</span><br><span class="line">      (EMAIL, FIRSTNAME, LASTNAME, STATUS, ADDR1, ADDR2, CITY, STATE, ZIP, COUNTRY, PHONE, USERID)</span><br><span class="line">    VALUES</span><br><span class="line">      (#&#123;email&#125;, #&#123;firstName&#125;, #&#123;lastName&#125;, #&#123;status&#125;, #&#123;address1&#125;,  #&#123;address2,jdbcType=VARCHAR&#125;, #&#123;city&#125;, #&#123;state&#125;, #&#123;zip&#125;, #&#123;country&#125;, #&#123;phone&#125;, #&#123;username&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--  </span><br><span class="line">  TODO MyBatis 3 does not map booleans to integers</span><br><span class="line">  &lt;update id="updateProfile" parameterType="Account"&gt;</span><br><span class="line">    UPDATE PROFILE SET</span><br><span class="line">      LANGPREF = #&#123;languagePreference&#125;,</span><br><span class="line">      FAVCATEGORY = #&#123;favouriteCategoryId&#125;,</span><br><span class="line">      MYLISTOPT = #&#123;listOption&#125;,</span><br><span class="line">      BANNEROPT = #&#123;bannerOption&#125;</span><br><span class="line">    WHERE USERID = #&#123;username&#125;</span><br><span class="line">  &lt;/update&gt;</span><br><span class="line">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateProfile"</span> <span class="attr">parameterType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">    UPDATE PROFILE SET</span><br><span class="line">      LANGPREF = #&#123;languagePreference&#125;,</span><br><span class="line">      FAVCATEGORY = #&#123;favouriteCategoryId&#125;</span><br><span class="line">    WHERE USERID = #&#123;username&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--  </span><br><span class="line">  TODO MyBatis 3 does not map booleans to integers</span><br><span class="line">  &lt;insert id="insertProfile" parameterType="Account"&gt;</span><br><span class="line">    INSERT INTO PROFILE (LANGPREF, FAVCATEGORY, MYLISTOPT, BANNEROPT, USERID)</span><br><span class="line">    VALUES (#&#123;languagePreference&#125;, #&#123;favouriteCategoryId&#125;, #&#123;listOption&#125;, #&#123;bannerOption&#125;, #&#123;username&#125;)</span><br><span class="line">  &lt;/insert&gt;</span><br><span class="line">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertProfile"</span> <span class="attr">parameterType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">    INSERT INTO PROFILE (LANGPREF, FAVCATEGORY, USERID)</span><br><span class="line">    VALUES (#&#123;languagePreference&#125;, #&#123;favouriteCategoryId&#125;, #&#123;username&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateSignon"</span> <span class="attr">parameterType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">    UPDATE SIGNON SET PASSWORD = #&#123;password&#125;</span><br><span class="line">    WHERE USERNAME = #&#123;username&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertSignon"</span> <span class="attr">parameterType</span>=<span class="string">"Account"</span>&gt;</span></span><br><span class="line">    INSERT INTO SIGNON (PASSWORD,USERNAME)</span><br><span class="line">    VALUES (#&#123;password&#125;, #&#123;username&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong> service: </strong><br>org.mybatis.jpetstore.service.AccountService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.jpetstore.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.mybatis.jpetstore.domain.Account;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.jpetstore.persistence.AccountMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Account <span class="title">getAccount</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> accountMapper.getAccountByUsername(username);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Account <span class="title">getAccount</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    Account account = <span class="keyword">new</span> Account();</span><br><span class="line">    account.setUsername(username);</span><br><span class="line">    account.setPassword(password);</span><br><span class="line">    <span class="keyword">return</span> accountMapper.getAccountByUsernameAndPassword(account);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertAccount</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">    accountMapper.insertAccount(account);</span><br><span class="line">    accountMapper.insertProfile(account);</span><br><span class="line">    accountMapper.insertSignon(account);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateAccount</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">    accountMapper.updateAccount(account);</span><br><span class="line">    accountMapper.updateProfile(account);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (account.getPassword() != <span class="keyword">null</span> &amp;&amp; account.getPassword().length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      accountMapper.updateSignon(account);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/mybatis/">mybatis</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/03/18/oracle/oracle同义词/" title="oracle同义词" itemprop="url">oracle同义词</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2013-03-17T20:54:24.000Z" itemprop="datePublished"> 发表于 2013-03-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>赋予user1创建同义词的权限<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">create</span> <span class="keyword">any</span> <span class="keyword">synonym</span> <span class="keyword">to</span> user1;  <span class="comment">--赋予adsend_map创建同义词的权限</span></span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">create</span> <span class="keyword">any</span> <span class="keyword">synonym</span> <span class="keyword">from</span> user1; <span class="comment">--回收adsend_map创建同义词的权限</span></span><br></pre></td></tr></table></figure></p>
<p>创建同义词例子:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">public</span> <span class="keyword">synonym</span> resp_send_cell <span class="keyword">for</span> adsend_new.resp_send_cell;</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/oracle/">oracle</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/03/03/oracle/创建oracle数据库账号,并限制权限/" title="创建oracle数据库账号,并限制权限" itemprop="url">创建oracle数据库账号,并限制权限</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2013-03-02T23:05:34.000Z" itemprop="datePublished"> 发表于 2013-03-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>需求:现需要给外包方提供oracle数据库的账号,将一些表和视图开放给外包方,并且让其可以建立自己的表</p>
<p><strong>1.首先登录数据库用户user_business,在此用户下创建外包方数据库用户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建用户，指定默认表空间</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> user_wb <span class="keyword">identified</span> <span class="keyword">by</span> pwd_wb </span><br><span class="line"><span class="keyword">DEFAULT</span> <span class="keyword">TABLESPACE</span> TB_DATA;</span><br></pre></td></tr></table></figure>
<p><strong>2.赋予权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">resource</span>, <span class="keyword">connect</span> <span class="keyword">to</span> user_wb;</span><br><span class="line"></span><br><span class="line"><span class="comment">--将table_a的所有操作权限赋予user_wb</span></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> table_a <span class="keyword">TO</span> user_wb;</span><br><span class="line"></span><br><span class="line"><span class="comment">--将V_GET_MSG视图的查询权限赋予user_wb</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> V_GET_MSG <span class="keyword">TO</span> user_wb;</span><br></pre></td></tr></table></figure>
<p><strong>3.用user_wb账户登录,即可查询table_a和V_GET_MSG</strong><br>因为表table_a和视图V_GET_MSG属于用户user_business,所以使用时必须加上前缀user_business</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_business.table_a;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> user_business.table_a;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> user_business.V_GET_MSG;</span><br></pre></td></tr></table></figure>
<p><strong>4.使用同义词简化语句</strong><br>登录user_business</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--为user_business.table_a创建全局同义词table_a</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PUBLIC</span> <span class="keyword">SYNONYM</span> table_a <span class="keyword">for</span> user_business.table_a;</span><br><span class="line"></span><br><span class="line"><span class="comment">--为user_business.V_GET_MSG创建全局同义词V_GET_MSG</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PUBLIC</span> <span class="keyword">SYNONYM</span> V_GET_MSG <span class="keyword">for</span> user_business.V_GET_MSG;</span><br></pre></td></tr></table></figure>
<p>在user_wb账户下即可使用如下查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table_a;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_a;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> V_GET_MSG;</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/oracle/">oracle</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/CentOS/" title="CentOS">CentOS<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/apache-commons/" title="apache-commons">apache-commons<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/git/" title="git">git<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/mybatis/" title="mybatis">mybatis<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/nginx/" title="nginx">nginx<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/oracle/" title="oracle">oracle<sup>15</sup></a></li>
		  
		
		  
			<li><a href="/categories/spring/" title="spring">spring<sup>6</sup></a></li>
		  
		
		</ul>
</div>


  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="John Doe">John Doe</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<script>
var option = {
  engineKey: '77e5fd75341fa457df97'
};
(function(w,d,t,u,n,s,e){
  s = d.createElement(t);
  s.src = u;
  s.async = 1;
  w[n] = function(r){
    w[n].opts = r;
  };
  e = d.getElementsByTagName(t)[0];
  e.parentNode.insertBefore(s, e);
})(window,document,'script','//tinysou-cdn.b0.upaiyun.com/ts.js','_ts');
_ts(option);
</script>

<!-- Tiny_search End -->

  </body>
 </html>
